---
import NominationForm from "@/components/Nominations/Nominations_Form.astro";
import Layout from "@/layouts/Layout.astro";
import { getTemplate } from "../db/mongodb.js";

// Get country info from headers, passed by Express middleware
const countrySiteHeader = Astro.request.headers.get('x-country-site');
const countrySite = countrySiteHeader ? JSON.parse(countrySiteHeader) : { slug: 'default', name: 'Dubai' };

// Fetch the entire template
const template = await getTemplate(countrySite.slug);
const dbContent = template?.config?.Contents || {};

// Define default content
const defaultNominationContent = {
    hero_background: "/backgrounds/Nomination-Banner.jpg",
    hero_title: "Nominate The Bright Minds Of Tomorrow!",
    hero_subtitle: "Recognize outstanding individuals and teams in robotics, research, and innovation. Your nomination can inspire the next generation of leaders.",
    hero_buttonText: "Nominate Now",
};

// Extract page-specific and layout content, merging with defaults
const content = { ...defaultNominationContent, ...(dbContent.Nomination || {}) };
const layoutContent = {
    nav: dbContent.Navbar || {},
    footer: dbContent.Footer || {},
    banner: dbContent.Banner || {},
};

const pageTitle = content.hero_title || `Erovoutika ${countrySite.name} - Nominations`;

---



<Layout title={pageTitle} content={layoutContent}>
    <section
        class="nomination-hero"
        style={`background-image: url(${content.hero_background});`}
    >
        <div class="hero-content">
            <h1 class="hero-title">{content.hero_title}</h1>
            <p class="hero-subtitle">{content.hero_subtitle}</p>
            <button class="nominate-button"
                >{content.hero_buttonText}</button
            >
        </div>
    </section>
    <section class="nomination-form" id="nominations">
        <NominationForm />
    </section>
</Layout>

<style>
    @import url("https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;700&display=swap");

    .html,
    body {
        margin: 0;
        padding: 0;
    }
    .nomination-hero {
        display: flex;
        flex-direction: column;
        background-size: cover;
        background-position: top center;
        background-repeat: no-repeat;
        justify-content: center;
        height: 100vh;
    }
    .hero-content {
        display: flex;
        flex-direction: column;
        align-items: start;
        color: white;
        padding-left: 60px;
        margin: 20px;
        gap: 30px;
    }
    .nomination-form {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
    }
    .hero-title {
        width: 55.62rem;
        font:
            400 7.5rem "Bebas Neue",
            sans-serif;
        line-height: 7.5rem;
        margin: 0;
    }
    .hero-subtitle {
        width: 55.62rem;
        font:
            400 1.5rem "Poppins",
            sans-serif;
        line-height: 2.5rem;
        margin-bottom: 10px;
    }
    .nominate-button {
        width: 19.9375rem;
        height: 4.875rem;
        border-radius: 2.625rem;
        border: 6px solid #fff;
        background: #0075ff;
        font: 500 1.875rem normal Poppins;
        color: #fff;
        transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .nominate-button:hover {
        transform: scale(1.08);
    }
</style>

<script is:inline>
    const nominateButton = document.querySelector(".nominate-button");
    nominateButton.addEventListener("click", () => {
        const introSection = document.getElementById("nomination-form");
        if (introSection) {
            introSection.scrollIntoView({ behavior: "smooth" });
        } else {
            console.error("Introduction section not found.");
        }
    });
</script>
