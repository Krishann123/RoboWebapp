---
import Layout from "../layouts/Layout.astro";
import "../styles/global.css";
import Cardnav from "../components/Cardnav.astro";
import { fetchPageContent } from "@/components/db";

const data = await fetchPageContent("News");
const Hero = data.Hero;
const latestnews = data["latest-news"];
const events = data["latest-events"];
const web = data["latest-webinar"];
const cards = data["latest-cards"];

const getImageUrl = (path) => {
    if (typeof path === 'string') {
        if (path.startsWith('public/')) {
            return import.meta.env.BASE_URL + '/' + path.substring(7);
        }
        if (path.startsWith('/')) {
            return import.meta.env.BASE_URL + path;
        }
    }
    return path;
};
---

<Layout title="Erovoutika Dubai - News">
    <section class="news-hero">
        <h1 class="news-hero-title">{Hero.title}</h1>
    </section>

    <div class="page-container">
        <section class="latest-news-section">
            <h2 class="section-title">{latestnews?.[0]?.NewsCard?.title}</h2>
            <div class="latest-news-grid">
                <div class="main-news-card">
                    <a href={latestnews?.[0]?.NewsCard?.link}>
                        <img src={getImageUrl(latestnews?.[0]?.NewsCard?.image)} alt={latestnews?.[0]?.NewsCard?.alt} />
                        <div class="main-news-card-overlay">
                            <p class="news-date">{latestnews?.[0]?.NewsCard?.date}</p>
                            <p class="news-description">{latestnews?.[0]?.NewsCard?.description}</p>
                        </div>
                    </a>
                </div>
                <div class="side-news-container">
                    <div class="side-news-card">
                        <a href={latestnews?.[1]?.NewsCard?.link}>
                            <img src={getImageUrl(latestnews?.[1]?.NewsCard?.image)} alt={latestnews?.[1]?.NewsCard?.alt} />
                            <div class="side-news-card-overlay">
                                <p class="news-date">{latestnews?.[1]?.NewsCard?.date}</p>
                                <p class="news-description-side">{latestnews?.[1]?.NewsCard?.description}</p>
                            </div>
                        </a>
                    </div>
                    <div class="side-news-card">
                        <a href={latestnews?.[2]?.NewsCard?.link}>
                            <img src={getImageUrl(latestnews?.[2]?.NewsCard?.image)} alt={latestnews?.[2]?.NewsCard?.alt} />
                             <div class="side-news-card-overlay">
                                <p class="news-date">{latestnews?.[2]?.NewsCard?.date}</p>
                                <p class="news-description-side">{latestnews?.[2]?.NewsCard?.description}</p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <section class="events-section">
            <h2 class="section-title">{events?.[0]?.NewsCard?.events}</h2>
            <div class="events-grid">
                {events.map(event => (
                    <div class="event-card">
                        <a href={event.NewsCard.link}>
                            <img src={getImageUrl(event.NewsCard.image)} alt={event.NewsCard.alt} />
                        </a>
                        <div class="event-card-content">
                            <p class="news-date">{event.NewsCard.date}</p>
                            <h5 class="event-title">{event.NewsCard.title}</h5>
                            <p class="event-description">{event.NewsCard.description}</p>
                        </div>
                    </div>
                ))}
            </div>
        </section>

        <section class="webinar-section">
            <h2 class="section-title">{web?.[0]?.NewsCard?.name}</h2>
             <div class="webinar-grid">
                {web.slice(1).map(item => (
                    <a href={item.NewsCard.link} class="webinar-card">
                        <img src={getImageUrl(item.NewsCard.image)} alt={item.NewsCard.alt} />
                        <div class="webinar-card-content">
                            <p class="news-date">{item.NewsCard.date}</p>
                            <h5 class="webinar-title">{item.NewsCard.title}</h5>
                            <p class="webinar-description">{item.NewsCard.description}</p>
                        </div>
                    </a>
                ))}
            </div>
        </section>
        
        <section class="more-news-section">
             <div class="cardnav-grid">
                {cards.map(card => (
                    <Cardnav image={getImageUrl(card.image)} icon={card.icon} text={card.text} source={card.source} link={card.link} date={card.date} />
                ))}
            </div>
        </section>
    </div>
</Layout>

<style>
    .page-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }

    .news-hero {
        text-align: center;
        padding: 4rem 2rem;
        background-color: #f8f9fa;
    }

    .news-hero-title {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 5rem;
        font-weight: bold;
        color: #212529;
    }

    .section-title {
        font-size: 2.5rem;
        font-family: 'Bebas Neue', sans-serif;
        margin-bottom: 2rem;
        margin-top: 3rem;
        color: #343a40;
    }

    .latest-news-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 1.5rem;
        height: 600px;
    }

    .main-news-card, .side-news-card {
        position: relative;
        overflow: hidden;
        border-radius: 0.5rem;
    }

    .main-news-card img, .side-news-card img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    
    .main-news-card:hover img, .side-news-card:hover img {
        transform: scale(1.05);
    }

    .main-news-card-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 1.5rem;
        color: white;
        background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
    }

    .news-date {
        font-size: 0.9rem;
        font-weight: 300;
        margin-bottom: 0.5rem;
    }

    .news-description {
        font-size: 2rem;
        font-weight: bold;
        font-family: 'Bebas Neue', sans-serif;
    }
    
    .news-description-side {
        font-size: 1.2rem;
        font-weight: bold;
    }

    .side-news-container {
        display: grid;
        grid-template-rows: 1fr 1fr;
        gap: 1.5rem;
    }
    
    .side-news-card-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 1rem;
        color: black;
        background: rgba(255, 255, 255, 0.8);
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .side-news-card:hover .side-news-card-overlay {
        opacity: 1;
    }

    .events-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .event-card {
        background: #ffffff;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .event-card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
    }

    .event-card-content {
        padding: 1.5rem;
    }

    .event-title {
        font-size: 1.5rem;
        font-weight: bold;
        margin: 0.5rem 0;
    }

    .event-description {
        font-size: 1rem;
        color: #6c757d;
    }

    .webinar-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }

    .webinar-card {
        display: flex;
        background: #ffffff;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .webinar-card img {
        width: 200px;
        height: auto;
        object-fit: cover;
    }

    .webinar-card-content {
        padding: 1.5rem;
    }
    
    .webinar-title {
        font-size: 1.5rem;
        font-weight: bold;
        margin: 0.5rem 0;
    }
    
    .webinar-description {
        font-size: 1rem;
        color: #6c757d;
    }
    
    .cardnav-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-top: 3rem;
    }
</style>
