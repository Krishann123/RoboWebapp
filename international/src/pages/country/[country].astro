---
import Jumbotron from "../../components/Home/Jumbotron.astro";
import Layout from "../../layouts/Layout.astro";
import Join from "../../components/Home/Joinrobo.astro";
import Package from "../../components/Home/Package.astro";
import Robolution from "@/components/Home/Robolution.astro";
import Highlights from "@/components/Home/Highlights.astro";
import FrequentlyAsk from "@/components/Home/FrequentlyAsk.astro";
import Partners from "@/components/Home/Partners";
import NewsAndUpdate from "@/components/Home/NewsAndUpdate.astro";
import { getCountryContent } from "@/components/db";

// Get country data passed from Express middleware
const { countryData } = Astro.locals;

// If no country data is found, redirect or show a 404
if (!countryData) {
  return Astro.redirect('/404');
}

// Set country info in response headers for server-side components
if (countryData) {
  Astro.response.headers.set('x-country-site', JSON.stringify({
    name: countryData.name,
    slug: countryData.slug,
    templateIndex: countryData.templateIndex
  }));
}

const pageTitle = `${countryData.name} - Robolution`;
---

<Layout title={pageTitle}>
    <!-- Add script to set country info for client-side components -->
    {countryData && (
        <script define:vars={{ countryInfo: {
            name: countryData.name,
            slug: countryData.slug,
            templateIndex: countryData.templateIndex
        }}}>
            window.countryInfo = countryInfo;
        </script>
    )}

    <Jumbotron 
        welcomeMessage={countryData.welcomeMessage}
        heroImage={countryData.heroImage}
        homeContent={countryData.homeContent}
        themeColors={countryData.themeColors}
        customCSS={countryData.customCSS}
    />
    <Robolution />
    <Package />
    <Highlights />
    <Join />
    <NewsAndUpdate countrySlug={countryData.slug} news={countryData.news} />
    <FrequentlyAsk />
    <Partners />
</Layout>

<style>
    #background {
        background-image: url("/international/homepage.png");
        background-repeat: no-repeat;
        background-size: cover;
        background-position: center center;
        background-color: transparent;
    }
</style> 