---
import Nav from "../components/navbar.astro";
import Banner from "../components/Home/Banner.astro";
import Footer1 from "../components/Home/Footer1.astro";
import "../styles/global.css";

const { title, content = {} } = Astro.props;
const { nav = {}, banner = {}, footer = {}, customStyles: pageCustomStyles = {} } = content;

const defaultStyles = {
    primaryColor: '#00008b',
    secondaryColor: '#FFB366',
    accentColor: '#6AAAFF',
    backgroundColor: '#FFFFFF'
};

const customStyles = { ...defaultStyles, ...pageCustomStyles };

const siteTitle = title || "Robolution International";

const countryCssVars = Object.entries(customStyles)
  .map(([key, value]) => `--${key.replace(/([A-Z])/g, '-$1').toLowerCase()}: ${value};`)
  .join(';');

const script = `
window.sitePath = {
  base: "${import.meta.env.BASE_URL || '/'}",
  asset: (path) => "${import.meta.env.BASE_URL || '/'}" + (path.startsWith('/') ? path.slice(1) : path),
  page: (path) => "${import.meta.env.BASE_URL || '/'}" + (path.startsWith('/') ? path.slice(1) : path)
};
console.log("Site path utilities initialized with base: ${import.meta.env.BASE_URL || '/'}");
`;

const countryContextScript = `
document.addEventListener('DOMContentLoaded', function() {
  const styles = ${JSON.stringify(customStyles)};
  const styleElement = document.createElement('style');
  styleElement.textContent = \`
    :root {
      --primary-color: \${styles.primaryColor};
      --secondary-color: \${styles.secondaryColor};
      --accent-color: \${styles.accentColor};
      --background-color: \${styles.backgroundColor};
    }
  \`;
  document.head.appendChild(styleElement);
});
`;
---

<!doctype html>
<html lang="en" class="dark">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <meta name="description" content={nav?.Content?.description || `Robolution International Site`} />
        <title>{siteTitle}</title>
        <link
            href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css"
            rel="stylesheet"
        />
        <script set:html={script} />
        <style is:inline set:html={`
          :root {
            ${countryCssVars}
          }
        `}></style>
        <script set:html={countryContextScript}></script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const toggleButton =
                    document.getElementById("toggleBannerButton");
                const banner = document.getElementById("banner");
                const bannerState = localStorage.getItem("bannerVisibility");

                if (banner) {
                    if (bannerState === "hidden") {
                        banner.style.display = "none";
                        if (toggleButton)
                            toggleButton.style.backgroundColor = "red";
                    } else {
                        banner.style.display = "block";
                        if (toggleButton)
                            toggleButton.style.backgroundColor = "green";
                    }
                }

                if (toggleButton && banner) {
                    toggleButton.addEventListener("click", () => {
                        if (banner.style.display === "none") {
                            banner.style.display = "block";
                            toggleButton.style.backgroundColor = "green";
                            localStorage.setItem("bannerVisibility", "visible");
                        } else {
                            banner.style.display = "none";
                            toggleButton.style.backgroundColor = "red";
                            localStorage.setItem("bannerVisibility", "hidden");
                        }
                    });
                }
            });
        </script>
    </head>
    <body>
        <div id="banner">
            <Banner content={banner} />
        </div>
        <Nav content={nav} />
        <slot />
        <Footer1 content={footer} />
    </body>
    <script
        is:inline
        src="https://cdn.jsdelivr.net/npm/flowbite@3.0.0/dist/flowbite.min.js"
    ></script>
</html>

<style>
    html,
    body {
        margin: 0;
        width: 100%;
        height: 100%;
    }
</style>